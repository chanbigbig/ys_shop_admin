import{$ as e,T as a,B as t,o as l,c as s,w as n,n as o,e as i,a2 as c,i as u,a as d,f as r,t as m,b as h,d as p,F as f,l as y,I as _,U as g,a7 as P,x as b,k as S}from"./index-b2e89937.js";import{_ as I}from"./u-modal.0ee7ad84.js";import{r as T}from"./uni-app.es.868efe30.js";import{P as C,e as v,a as x,p as w,b as A}from"./wechat.464afe1e.js";import{_ as k}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-loading.0a15a37b.js";import"./u-popup.56686fc1.js";import"./u-icon.3564f78b.js";const D="recharge/center",M="recharge/submit",E="recharge/tradeQuery";const U={[C.WECHAT.value]:"icon-wechat-pay",[C.ALIPAY.value]:"icon-alipay"},V={[C.WECHAT.value]:"微信",[C.ALIPAY.value]:"支付宝"};const L=k({data:()=>({isLoading:!0,disabled:!1,PayMethodEnum:C,PayMethodIconEnum:U,PayMethodClientNameEnum:V,personal:{balance:"0.00"},setting:{},planList:[],methods:[],selectedPlanId:0,inputValue:"",curPaymentItem:null,showConfirmModal:!1,tempUnifyData:{outTradeNo:"",method:""}}),onShow(e){this.getPageData()},methods:{onSelectPlan(e){this.selectedPlanId=e,this.inputValue=""},onChangeMoney({detail:e}){this.inputValue=e.value,this.selectedPlanId=0},handleSelectPayType(e){this.curPaymentItem=this.methods[e]},getPageData(){const a=this;return a.isLoading=!0,new Promise(((t,l)=>{var s;(s={client:a.platform},e.get(D,s)).then((e=>{a.setting=e.data.setting,a.personal=e.data.personal,a.planList=e.data.planList,a.methods=e.data.paymentMethods,a.isLoading=!1,a.setDefaultPayType(),this.performance()}))}))},setDefaultPayType(){this.curPaymentItem||this.handleSelectPayType(0)},performance(){const e=this,a=(e=>{const a=c.get("tempUnifyData_"+e);return a?(c.remove("tempUnifyData_"+e),a):null})("recharge");a&&(e.tempUnifyData=a,e.showConfirmModal=!0)},onSubmit(a){const t=this;var l;t.curPaymentItem?t.disabled||(t.disabled=!0,(l={planId:t.selectedPlanId,customMoney:t.inputValue?t.inputValue:"",method:t.curPaymentItem.method,client:t.platform,extra:t.getExtraAsUnify(t.curPaymentItem.method)},e.post(M,{form:l})).then((e=>t.onSubmitCallback(e))).finally((e=>{setTimeout((()=>t.disabled=!1),10)}))):t.$toast("您还没有选择支付方式")},getExtraAsUnify:e=>e===C.ALIPAY.value?v():e===C.WECHAT.value?x():{},onSubmitCallback(e){const a=this,t=a.curPaymentItem.method,l=e.data.payment;t===C.BALANCE.value&&a.onShowSuccess(e),t===C.ALIPAY.value&&(console.log("paymentData",l),w({orderKey:"recharge",...l}).then((e=>a.onPaySuccess(e))).catch((e=>a.onPayFail(e)))),t===C.WECHAT.value&&(console.log("paymentData",l),A({orderKey:"recharge",...l}).then((e=>a.onPaySuccess(e))).catch((e=>a.onPayFail(e))))},onPaySuccess({res:e,option:{isRequireQuery:a,outTradeNo:t,method:l}}){if(a)return this.onTradeQuery(t,l),!0;this.onShowSuccess(e)},onShowSuccess({message:e}){this.$toast(e||"订单支付成功"),this.onSuccessNav()},onPayFail(e){console.log("onPayFail",e);const a=e.message||"订单未支付";this.$error(a)},onTradeQuery(a,t){const l=this;var s;(s={outTradeNo:a,method:t,client:l.platform},e.get(E,s)).then((e=>e.data.isPay?l.onShowSuccess(e):l.onPayFail(e))).finally((()=>l.showConfirmModal=!1))},onSuccessNav(){const e=a(),l=e.length<2?null:e[e.length-2];l&&t(l.route,["pages/wallet/index"])?setTimeout((()=>uni.navigateBack()),1e3):setTimeout((()=>{this.$navTo("pages/wallet/index",{},"redirectTo")}),1200)}}},[["render",function(e,a,t,c,C,v){const x=y,w=u,A=_,k=g,D=P,M=T(b("u-modal"),I);return C.personal.user_id?(l(),s(w,{key:0,class:"container",style:o(e.appThemeStyle)},{default:n((()=>[d(w,{class:"account-panel dis-flex flex-y-center"},{default:n((()=>[d(w,{class:"panel-lable"},{default:n((()=>[d(x,null,{default:n((()=>[r("账户余额")])),_:1})])),_:1}),d(w,{class:"panel-balance flex-box"},{default:n((()=>[d(x,null,{default:n((()=>[r("￥"+m(C.personal.balance),1)])),_:1})])),_:1})])),_:1}),d(w,{class:"recharge-panel"},{default:n((()=>[d(w,{class:"recharge-label"},{default:n((()=>[d(x,null,{default:n((()=>[r("充值金额")])),_:1})])),_:1}),d(w,{class:"recharge-plan clearfix"},{default:n((()=>[(l(!0),h(f,null,p(C.planList,((e,a)=>(l(),s(w,{key:a,class:S(["recharge-plan_item",{active:C.selectedPlanId==e.plan_id}]),onClick:a=>v.onSelectPlan(e.plan_id)},{default:n((()=>[d(w,{class:"plan_money"},{default:n((()=>[d(x,null,{default:n((()=>[r(m(e.money),1)])),_:2},1024)])),_:2},1024),d(w,{class:"plan_gift"},{default:n((()=>[d(x,null,{default:n((()=>[r("送"+m(e.gift_money),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1}),1==C.setting.is_custom?(l(),s(w,{key:0,class:"recharge-input"},{default:n((()=>[d(A,{class:"input",type:"digit",placeholder:"可输入自定义充值金额",modelValue:C.inputValue,"onUpdate:modelValue":a[0]||(a[0]=e=>C.inputValue=e),onInput:v.onChangeMoney},null,8,["modelValue","onInput"])])),_:1})):i("",!0),d(w,{class:"recharge-label m-top60"},{default:n((()=>[d(x,null,{default:n((()=>[r("支付方式")])),_:1})])),_:1}),d(w,{class:"payment-method"},{default:n((()=>[(l(!0),h(f,null,p(C.methods,((e,a)=>(l(),s(w,{key:a,class:"pay-item dis-flex flex-x-between",onClick:e=>v.handleSelectPayType(a)},{default:n((()=>[d(w,{class:"item-left dis-flex flex-y-center"},{default:n((()=>[d(w,{class:S(["item-left_icon",[e.method]])},{default:n((()=>[d(x,{class:S(["iconfont",[C.PayMethodIconEnum[e.method]]])},null,8,["class"])])),_:2},1032,["class"]),d(w,{class:"item-left_text"},{default:n((()=>[d(x,null,{default:n((()=>[r(m(C.PayMethodEnum[e.method].name),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),C.curPaymentItem&&C.curPaymentItem.method==e.method?(l(),s(w,{key:0,class:"item-right col-m"},{default:n((()=>[d(x,{class:"iconfont icon-check"})])),_:1})):i("",!0)])),_:2},1032,["onClick"])))),128))])),_:1}),d(w,{class:"recharge-submit btn-submit"},{default:n((()=>[d(D,{onSubmit:v.onSubmit},{default:n((()=>[d(k,{class:"button",formType:"submit",disabled:C.disabled},{default:n((()=>[r("立即充值")])),_:1},8,["disabled"])])),_:1},8,["onSubmit"])])),_:1})])),_:1}),d(w,{class:"describe-panel"},{default:n((()=>[d(w,{class:"recharge-label"},{default:n((()=>[d(x,null,{default:n((()=>[r("充值说明")])),_:1})])),_:1}),d(w,{class:"content"},{default:n((()=>[d(x,{space:"ensp"},{default:n((()=>[r(m(C.setting.describe),1)])),_:1})])),_:1})])),_:1}),C.tempUnifyData?(l(),s(M,{key:0,modelValue:C.showConfirmModal,"onUpdate:modelValue":a[1]||(a[1]=e=>C.showConfirmModal=e),title:"支付确认","show-cancel-button":"","confirm-text":"已完成支付","confirm-color":e.appTheme.mainBg,"negative-top":"100",asyncClose:!0,onConfirm:a[2]||(a[2]=e=>v.onTradeQuery(C.tempUnifyData.outTradeNo,C.tempUnifyData.method))},{default:n((()=>[d(w,{class:"modal-content"},{default:n((()=>[d(x,null,{default:n((()=>[r("请在"+m(C.PayMethodClientNameEnum[C.tempUnifyData.method])+"内完成支付，如果您已经支付成功，请点击“已完成支付”按钮",1)])),_:1})])),_:1})])),_:1},8,["modelValue","confirm-color"])):i("",!0)])),_:1},8,["style"])):i("",!0)}],["__scopeId","data-v-f6fcc237"]]);export{L as default};
